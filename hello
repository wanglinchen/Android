message(STATUS "enter ${CMAKE_CURRENT_SOURCE_DIR}")

macro(SUBDIRLIST RESULT CURDIR)
file(GLOB CURRENT_DIR_FILES RELATIVE ${CURDIR} ${CURDIR}/*)
set(DIRLIST "")
foreach(FILE ${CURRENT_DIR_FILES})
    if(IS_DIRECTORY ${CURDIR}/${FILE})
        if(EXISTS ${CURDIR}/${FILE}/CMakeLists.txt)
            list(APPEND DIRLIST ${FILE})
        endif()
    endif()
endforeach(FILE)
set(${RESULT} ${DIRLIST})
endmacro()

SUBDIRLIST(CURRENT_SUB_DIRS ${CMAKE_CURRENT_SOURCE_DIR})
message(STATUS "CURRENT_SUB_DIRS:${CURRENT_SUB_DIRS}")

file(GLOB CURRENT_DIR_SRCS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} 
    ${CMAKE_CURRENT_SOURCE_DIR}/*.c
    ${CMAKE_CURRENT_SOURCE_DIR}/*.cpp
    ${CMAKE_CURRENT_SOURCE_DIR}/*.h
    ${CMAKE_CURRENT_SOURCE_DIR}/*.hpp
)
message(STATUS "CURRENT_DIR_SRCS:${CURRENT_DIR_SRCS}")


foreach(SUB_DIR ${CURRENT_SUB_DIRS})
    message(STATUS "add SUB_DIR:${SUB_DIR}")
    add_subdirectory(${SUB_DIR})
endforeach()


